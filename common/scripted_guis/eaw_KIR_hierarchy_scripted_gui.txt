scripted_gui = {
	kir_hierarchy_gui = {
		context_type = decision_category
		parent_window_token = decision_tab

		window_name = "kir_hierarchy_window"

		effects = {
			kir_hierarchy_character_button_click = {
				if = {  # if hch is already selected
					limit = { has_variable = selected_hch_value }
					if = {  # if the same hch was clicked, remove selection
						limit = {
							check_variable = { selected_hch_value = hch_value }
						}
						kir_clear_selection_effect = yes  # clear the selection
					}
					else = {  # other hch slot was clicked
						kir_move_select_hch_var_setup_effect = yes
						if = {  # if current selection is empty, select the other slot
							limit = {
								check_variable = { selected_hch_id = 0 }
							}
							kir_select_hch_var_setup_effect = yes
						}
						else = {  # else do moving
							if = {  # if the slot we clicked is empty, move our selected hch
								limit = {
									check_variable = { move_hch_id = 0 }
								}
								move_hch_effect = yes
							}  # if second slot is taken, do nothing
							kir_clear_move_selection_effect = yes  # clean the second slot vars
							kir_clear_selection_effect = yes  # clear the selection
						}
					}
				}
				else = {  # if hch not selected, select one
					kir_select_hch_var_setup_effect = yes
				}

				# if the new selected slot has no character in it, open character selection
				if = {
					limit = {
						has_variable = selected_hch_value  # has selected a slot
						check_variable = { selected_hch_id = 0 }  # the slot is empty
					}
					set_country_flag = kir_hch_selection_visible_flag
					kir_move_select_hch_var_setup_effect = yes
				} else = {
					clr_country_flag = kir_hch_selection_visible_flag
				}
			}

			# kir_hierarchy_character_button_left_click = {
			# 	#
			# }
		}

		triggers = {
			kir_hch_selected_glow_visible = {
				check_variable = { var:hch_value = var:selected_hch_value }
			}
		}

		properties = {
			kir_hierarchy_character_button = {
				image = "[GetHCHgfx]"
			}
		}

		dynamic_lists = {
			kir_hierarchy_level_1_gridbox = {
				array = level_1_hchs_array
				entry_container = "kir_hierarchy_character_entry"
				value = hch_value
			}
			kir_hierarchy_level_2_gridbox = {
				array = level_2_hchs_array
				entry_container = "kir_hierarchy_character_entry"
				value = hch_value
			}
			kir_hierarchy_level_3_gridbox = {
				array = level_3_hchs_array
				entry_container = "kir_hierarchy_character_entry"
				value = hch_value
			}
			kir_hierarchy_level_4_gridbox = {
				array = level_4_hchs_array
				entry_container = "kir_hierarchy_character_entry"
				value = hch_value
			}
			kir_hierarchy_level_5_gridbox = {
				array = level_5_hchs_array
				entry_container = "kir_hierarchy_character_entry"
				value = hch_value
			}
		}
	}

	kir_hierarchy_hch_selection_gui = {
		# context_type = decision_category
		parent_window_token = decision_tab

		window_name = "kir_hierarchy_hch_selection_window"

		visible = {
			has_country_flag = kir_hch_selection_visible_flag
		}

		effects = {
			kir_hierarchy_character_selection_button_click = {
				# select the current character to move
				kir_select_hch_var_setup_effect = yes
				# move them
				move_hch_effect = yes
				# remove the moved character from stored characters
				remove_hch_from_selection_effect = yes

				# clear everything
				kir_clear_selection_effect = yes
				kir_clear_move_selection_effect = yes
				clr_country_flag = kir_hch_selection_visible_flag
			}
		}

		properties = {
			kir_hierarchy_character_selection_button = {
				image = "[GetHCHgfx]"
			}
		}

		dynamic_lists = {
			kir_hch_selection_gridbox = {
				array = all_hchs_array
				entry_container = "kir_hierarchy_hch_selection_entry"
				value = hch_value
			}
		}
	}
}
