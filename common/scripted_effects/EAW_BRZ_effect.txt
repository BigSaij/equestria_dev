# What are these for?
add_latest_tank_licence_to_root = {
	if = {
		limit = {
			has_tech = gwtank
		}
		create_production_license = {
			target = ROOT
			equipment = {
				type = gw_tank_equipment
			}
			cost_factor = 0
		}
	}
	else_if = {
		limit = {
			has_tech = basic_light_tank
		}
		create_production_license = {
			target = ROOT
			equipment = {
				type = light_tank_equipment_1
			}
			cost_factor = 0
		}
	}
	else_if = {
		limit = {
			has_tech = improved_light_tank
		}
		create_production_license = {
			target = ROOT
			equipment = {
				type = light_tank_equipment_2
			}
			cost_factor = 0
		}
	}
	else_if = {
		limit = {
			has_tech = advanced_light_tank
		}
		create_production_license = {
			target = ROOT
			equipment = {
				type = light_tank_equipment_3
			}
			cost_factor = 0
		}
	}
	else_if = {
		limit = {
			has_tech = advanced_light_tank_a
		}
		create_production_license = {
			target = ROOT
			equipment = {
				type = light_tank_equipment_x
			}
			cost_factor = 0
		}
	}
	else_if = {
		limit = {
			has_tech = advanced_light_tank_b
		}
		create_production_license = {
			target = ROOT
			equipment = {
				type = light_tank_equipment_x_2
			}
			cost_factor = 0
		}
	}

	if = {
		limit = {
			has_tech = basic_medium_tank
		}
		create_production_license = {
			target = ROOT
			equipment = {
				type = medium_tank_equipment_1
			}
			cost_factor = 0
		}
	}
	else_if = {
		limit = {
			has_tech = improved_medium_tank
		}
		create_production_license = {
			target = ROOT
			equipment = {
				type = medium_tank_equipment_2
			}
			cost_factor = 0
		}
	}
	else_if = {
		limit = {
			has_tech = advanced_medium_tank
		}
		create_production_license = {
			target = ROOT
			equipment = {
				type = medium_tank_equipment_3
			}
			cost_factor = 0
		}
	}

	if = {
		limit = {
			has_tech = main_battle_tank
		}
		create_production_license = {
			target = ROOT
			equipment = {
				type = modern_tank_equipment_1
			}
			cost_factor = 0
		}
	}
	else_if = {
		limit = {
			has_tech = main_battle_tank_a
		}
		create_production_license = {
			target = ROOT
			equipment = {
				type = modern_tank_equipment_x
			}
			cost_factor = 0
		}
	}
	else_if = {
		limit = {
			has_tech = main_battle_tank_b
		}
		create_production_license = {
			target = ROOT
			equipment = {
				type = modern_tank_equipment_x_2
			}
			cost_factor = 0
		}
	}
	else_if = {
		limit = {
			has_tech = main_battle_tank_c
		}
		create_production_license = {
			target = ROOT
			equipment = {
				type = modern_tank_equipment_x_3
			}
			cost_factor = 0
		}
	}
	else_if = {
		limit = {
			has_tech = main_battle_tank_d
		}
		create_production_license = {
			target = ROOT
			equipment = {
				type = modern_tank_equipment_x_4
			}
			cost_factor = 0
		}
	}
	else_if = {
		limit = {
			has_tech = main_battle_tank_e
		}
		create_production_license = {
			target = ROOT
			equipment = {
				type = modern_tank_equipment_x_5
			}
			cost_factor = 0
		}
	}

	if = {
		limit = {
			has_tech = basic_heavy_tank
		}
		create_production_license = {
			target = ROOT
			equipment = {
				type = heavy_tank_equipment_1
			}
			cost_factor = 0
		}
	}
	else_if = {
		limit = {
			has_tech = improved_heavy_tank
		}
		create_production_license = {
			target = ROOT
			equipment = {
				type = heavy_tank_equipment_2
			}
			cost_factor = 0
		}
	}
	else_if = {
		limit = {
			has_tech = advanced_heavy_tank
		}
		create_production_license = {
			target = ROOT
			equipment = {
				type = heavy_tank_equipment_3
			}
			cost_factor = 0
		}
	}
	
	if = {
		limit = {
			has_tech = super_heavy_tank
		}
		create_production_license = {
			target = ROOT
			equipment = {
				type = super_heavy_tank_equipment_1
			}
			cost_factor = 0
		}
	}
	else_if = {
		limit = {
			has_tech = super_heavy_tank_a
		}
		create_production_license = {
			target = ROOT
			equipment = {
				type = super_heavy_tank_equipment_x
			}
			cost_factor = 0
		}
	}
	else_if = {
		limit = {
			has_tech = super_heavy_tank_b
		}
		create_production_license = {
			target = ROOT
			equipment = {
				type = super_heavy_tank_equipment_x_2
			}
			cost_factor = 0
		}
	}
}

add_latest_infantry_equipment_licence_to_root = {
	if = {
		limit = {
			has_tech = infantry_weapons
		}
		create_production_license = {
			target = ROOT
			equipment = {
				type = infantry_equipment_0
			}
			cost_factor = 0
		}
	}
	else_if = {
		limit = {
			has_tech = infantry_weapons1
		}
		create_production_license = {
			target = ROOT
			equipment = {
				type = infantry_equipment_1
			}
			cost_factor = 0
		}
	}
	else_if = {
		limit = {
			has_tech = improved_infantry_weapons
		}
		create_production_license = {
			target = ROOT
			equipment = {
				type = infantry_equipment_2
			}
			cost_factor = 0
		}
	}
	else_if = {
		limit = {
			has_tech = advanced_infantry_weapons
		}
		create_production_license = {
			target = ROOT
			equipment = {
				type = infantry_equipment_3
			}
			cost_factor = 0
		}
	}
	else_if = {
		limit = {
			has_tech = advanced_infantry_weapons_b
		}
		create_production_license = {
			target = ROOT
			equipment = {
				type = infantry_equipment_x
			}
			cost_factor = 0
		}
	}
	else_if = {
		limit = {
			has_tech = advanced_infantry_weapons_e
		}
		create_production_license = {
			target = ROOT
			equipment = {
				type = infantry_equipment_x_2
			}
			cost_factor = 0
		}
	}

	if = {
		limit = {
			has_tech = magical_weapons
		}
		create_production_license = {
			target = ROOT
			equipment = {
				type = magical_equipment_1
			}
			cost_factor = 0
		}
	}
	else_if = {
		limit = {
			has_tech = magical_weapons1
		}
		create_production_license = {
			target = ROOT
			equipment = {
				type = magical_equipment_2
			}
			cost_factor = 0
		}
	}
	else_if = {
		limit = {
			has_tech = magical_weapons2
		}
		create_production_license = {
			target = ROOT
			equipment = {
				type = magical_equipment_3
			}
			cost_factor = 0
		}
	}
	else_if = {
		limit = {
			has_tech = magical_weapons3
		}
		create_production_license = {
			target = ROOT
			equipment = {
				type = magical_equipment_4
			}
			cost_factor = 0
		}
	}
}

BRZ_recalculate_noble_virtue_effects = {
	if = {
		limit = {
			check_variable = { noble_virtue > 100 }
		}
		set_variable = {
			var = noble_virtue
			value = 100
		}
	}
	if = {
		limit = {
			check_variable = { noble_virtue < 0 }
		}
		set_variable = {
			var = noble_virtue
			value = 0
		}
	}
	
	# TODO: activate fail mission if value is 0

	set_variable = {
		var = noble_virtue_effect_stab
		value = noble_virtue
	}
	divide_variable = {
		var = noble_virtue_effect_stab
		value = 200 # 50% at 100 noble virtue
	}
	
	set_variable = {
		var = noble_virtue_effect_pop
		value = noble_virtue
	}
	divide_variable = {
		var = noble_virtue_effect_pop
		value = 200 # 50% at 100 noble virtue
	}
}

BRZ_puppeted_by_grover_ii = {
	# Load the flavour focus tree - keep_completed for Industry/Army trees
	load_focus_tree = {
		tree = bronzehill_grover_ii_tree
		keep_completed = yes
	}
	
	# If Powerstruggle, end immediately - Ignatius stays in Power
	if = {
		limit = {
			has_idea = BRZ_powerstruggle_in_the_council
		}
		remove_ideas = BRZ_powerstruggle_in_the_council
		
		remove_mission = BRZ_council_timeout_mission
		remove_mission = BRZ_copperhill_influence_mission
		remove_mission = BRZ_loudbark_influence_mission
		if = {
			limit = {
				has_country_flag = BRZ_luxembark_in_the_council
			}
			remove_mission = BRZ_luxembark_influence_mission
		} else = {
			remove_mission = BRZ_barkingsun_influence_mission
		}
		
		add_popularity = {
			ideology = neutrality
			popularity = 0.1
		}
	}
	
	# Remove maluses that would be removed by the now unavailable focus tree
	if = {
		limit = {
			has_idea = BRZ_disloyal_army
		}
		remove_ideas = BRZ_disloyal_army
	}
	if = {
		limit = {
			has_idea = BRZ_socialist_agitation
		}
		remove_ideas = BRZ_socialist_agitation
	}
	if = {
		limit = {
			has_idea = BRZ_lingering_socialist_agitation
		}
		remove_ideas = BRZ_lingering_socialist_agitation
	}
	if = {
		limit = {
			has_idea = BRZ_unrest_in_academia
		}
		remove_ideas = BRZ_unrest_in_academia
	}
	if = {
		limit = {
			has_idea = BRZ_hostile_ignatius
		}
		remove_ideas = BRZ_hostile_ignatius
	}
	if = {
		limit = {
			has_idea = BRZ_hostile_bronzehill_council
		}
		remove_ideas = BRZ_hostile_bronzehill_council
	}
}